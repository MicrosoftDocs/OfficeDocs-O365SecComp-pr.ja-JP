---
title: office 365 のテナント分離 (office 365 Search)
ms.author: robmazz
author: robmazz
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
description: '概要: Office 365 検索でのテナントの分離について説明します。'
ms.openlocfilehash: 5254ffe2e6b92c6ba100a9e45b35b456ead1b000
ms.sourcegitcommit: 0017dc6a5f81c165d9dfd88be39a6bb17856582e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "32262599"
---
# <a name="tenant-isolation-in-office-365-search"></a>Office 365 検索でのテナントの分離
SharePoint Online の検索では、テナント間の情報リークに対する保護と、共有データ構造の効率のバランスを実現するテナント分離モデルが使用されます。 このモデルを使用すると、次のような検索機能を使用できなくなります。
- 他のテナントからのドキュメントを含むクエリの結果を返す
- 熟練ユーザーが他のテナントに関する情報を推測できる、クエリ結果に十分な情報を公開する
- 別のテナントのスキーマまたは設定を表示する
- テナント間での分析処理情報の混在、または正しくないテナントへの結果の保存
- 別のテナントからの辞書エントリを使用する

テナントデータの種類ごとに、情報を誤ってリークしないようにするために、1つまたは複数のコードの保護層を使用します。 最も重要なデータは、1つの欠陥によって実際または情報漏洩が発生しないことを確認するために、最も多くの保護レイヤーを備えています。

## <a name="tenant-separation-for-the-search-index"></a>検索インデックスのテナントの分離
検索インデックスは、インデックスコンポーネントをホストしているサーバーのディスクに格納され、テナントはインデックスファイルを共有します。 テナントのインデックス付きドキュメントは、そのテナントのクエリに対してのみ表示されます。 情報漏洩を防止する3つの独立したメカニズム:
- テナント ID フィルター
- テナント ID 用語のプレフィックス
- ACL チェック

検索によって正しくないテナントにドキュメントが返されるようにするには、3つのメカニズムがすべて失敗する必要があります。

## <a name="tenant-id-filtering-and-tenant-id-term-prefixing"></a>テナント id フィルターとテナント id 用語のプレフィックス
検索では、フルテキストインデックスでインデックスが付けられたすべての用語がテナント ID でプレフィックスされます。 たとえば、ID が "*123*" のテナントに対して "*foo*" という用語がインデックス付けされている場合、フルテキストインデックス内のエントリは "123foo" になり*ます。*

すべてのクエリは、テナント id フィルターと呼ばれるプロセスを使用して、テナント id を含むように変換されます。 たとえば、クエリ "*foo*" は "<*guid*>" に変換されます。*foo*および*tenantID*: <*guid*> "。ここで、<*guid*> は、クエリを実行するテナントを表します。 このクエリ変換は各インデックスノード内で行われ、クエリもコンテンツ処理も影響を及ぼすことはありません。 テナント ID はすべてのクエリに追加されるため、その他のテナント内の用語の頻度は、1つのテナントで最適な一致ランクを調べることでは推論できません。

テナント ID 用語のプレフィックスは、フルテキストインデックスでのみ行われます。 "*title: foo*" のような検索は、代理検索インデックスに移動します。これには、用語の先頭にテナント ID が付いていません。 代わりに、フィールド名の先頭に検索語が付けられます。 たとえば、クエリ "*title: foo*" は "*fields. title: foo AND fields.*<*guid*>" に変換されます。 用語の頻度は、代理検索インデックス内のヒットのランク付けには影響しないため、用語のプレフィックスによるテナントの分離は必要ありません。 「*title: foo*」のような検索を行う場合、テナントのコンテンツの分離は、クエリ変換によるテナント ID フィルターに依存します。

## <a name="document-access-control-list-checks"></a>ドキュメントアクセス制御リストのチェック
検索では、検索インデックスに保存されている acl 経由でドキュメントへのアクセスを制御します。 各アイテムには、特殊な ACL フィールド内の一連の用語がインデックス化されています。 ACL フィールドには、ドキュメントを表示できる1つまたは複数のグループまたはユーザーごとの用語が含まれています。 すべてのクエリは、認証されたユーザーが属するグループごとに1つずつ、アクセス制御エントリ (ACE) 用語のリストによって補強されます。

たとえば、"<*guid*>" のようなクエリがあるとします。*foo と tenantID*: <*guid*> "は:" <*guid*> になります。*foo と tenantID*: <*guid*> *と*(*docacl:*<*ace1*> *または docacl*:*< ace2*> *または docacl*: <*ace3*> *...*)"

ユーザー id とグループ識別子、および ace が一意であるため、一部のユーザーにのみ表示されるドキュメントのテナント間では、これによってセキュリティレベルが強化されます。 これは、テナント内の通常のユーザーにアクセスを許可する "外部ユーザー以外のすべてのユーザー" ACE の場合と同じです。 しかし、"Everyone" の ace はすべてのテナントで同じであるため、パブリックドキュメントのテナントの分離はテナント ID フィルターに依存します。 拒否 ace もサポートされています。 クエリの拡張によって、拒否 ACE と一致する場合に結果からドキュメントを削除する句が追加されます。

Exchange online search では、インデックスは SharePoint online と同様に、テナント id (サブスクリプション ID) ではなく、個々のユーザーのメールボックスのメールボックス ID でパーティション分割されます。 パーティション分割メカニズムは SharePoint Online と同じですが、ACL フィルターはありません。
