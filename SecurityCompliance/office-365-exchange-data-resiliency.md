---
title: Office 365 の Exchange データの復元
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
audience: ITPro
ms.topic: article
ms.service: Office 365 Administration
localization_priority: None
search.appverid:
- MET150
ms.collection: Strat_O365_Enterprise
description: Exchange オンラインおよび Office 365 内でのデータの復元のさまざまな側面の説明。
ms.openlocfilehash: 8d0448a95f010b766faf852a374513a1c2da61fa
ms.sourcegitcommit: 36c5466056cdef6ad2a8d9372f2bc009a30892bb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/27/2018
ms.locfileid: "22532043"
---
# <a name="exchange-online-data-resiliency-in-office-365"></a>Office 365 で Exchange のオンライン ・ データのリカバリ性

## <a name="introduction"></a>概要
Exchange データベースに影響を与える破損の 2 種類があります: 物理的な破損は、通常が原因で、特定のストレージ ・ ハードウェア) のハードウェアの問題、およびその他の要因が原因で発生する、論理的な破損。一般は、Exchange データベース内で発生することが論理的な破損の 2 種類があります。 
- **データベースの論理的な破損**のページ上のデータが、データベース ページのチェックサムと一致問題が論理的にあります。これは、(拡張可能なストレージ エンジン (ESE)) データベース エンジンがデータベース ・ ページを作成しようとすると、オペレーティング システムには、成功メッセージが返される場合でも発生する可能性が、データも書き込まれることは、ディスクにするか、間違った場所に書き込まれます。これは*フラッシュが失われる*と呼ばれます。ESE には、多数の機能と、データベースおよびその他のデータ損失のシナリオの物理的な破損を防ぐために設計された保護機能が含まれています。失われたフラッシュを防ぐため、データを失うことから、ESE には、それを修正する機能 (単一ページの復元) とデータベースの失われたフラッシュ検出メカニズムが含まれます。 
- **ストアの論理的破損**からのデータが追加、削除、または、ユーザーが予期しない方法で操作します。このような場合は通常、サードパーティ製のアプリケーションで発生します。一般には、ユーザーを表示することが破損としての意味での破損のみです。Exchange ストアでは、一連の MAPI 操作を有効にする論理的な破損を生成したトランザクションと見なされます。Exchange Online で[インプレース保持](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds)機能は、(これにより、コンテンツが、ユーザーまたはアプリケーションが完全に削除される) ために、ストアの論理的破損から保護を提供します。 

Exchange Online は、ログを検査し、ログの再生時にレプリケートされたログ ・ ファイルのいくつかの整合性チェックを実行します。これらの整合性チェックは、システムによって複製されるを物理的な破損を防ぐためです。たとえば、ログの検査中には物理的な整合性チェック、ログ ファイルを確認し、ログ ファイルに記録されているチェックサムがメモリ内で生成されたチェックサムと一致しているかを検証します。さらに、ログ ファイルのログのヘッダーに記録されているログ ファイルの署名に一致するかどうかを確認するのには、ログ ファイルのヘッダーが調べられます。ログの再生中には、ログ ファイルと、審査の厳格化で実施さらにします。たとえば、データベース ヘッダーには、ログの署名と一致していることを確認するのにはログ ファイルの署名と比較するも含まれます。 

Exchange ネイティブ データ保護、アプリケーション ・ レベル ・ レプリケーションを活用して、複数のサーバー、およびその他の複数のデータ センター間で弾力性の戦略を使用して Exchange Online のメールボックス データの破損に対する保護を実現します。データ破損やその他の理由から失われるからデータを保護するための機能です。これらの機能には、次のように Microsoft または自体には、Exchange のオンラインのアプリケーションによって管理されているネイティブの機能があります。

- [データ可用性グループ](https://docs.microsoft.com/exchange/back-up-email)
- 1 ビット訂正 
- オンライン データベースをスキャン 
- フラッシュの検出が失われる 
- 単一ページの復元 
- メールボックス レプリケーション サービス 
- ログ ファイルのチェック 
- 弾力性のあるファイル ・ システムの展開 

上記のネイティブ機能の詳細については、上記のハイパーリンクをクリックして、関連情報とハイパーリンクなしのアイテムの詳細については、以下を参照してください。、これらのネイティブな機能だけでなく Exchange Online も含まれています、次のように顧客を管理するデータのリカバリ性能に関する機能。 
- [(既定で有効になっている) 1 つのアイテムの復元](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [インプレース保持と訴訟ホールド](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [削除済みアイテムの保持と Soft-Deleted のメールボックス (どちらも既定で有効になっている)](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a>データベース可用性グループ 
Office 365 内のすべてのメールボックス データベースは[データベース可用性グループ (DAG)](https://docs.microsoft.com/exchange/back-up-email)でホストされているし、同じ領域内にある地理的に別のデータ センターに複製します。最も一般的な構成は、4 つのデータベースのコピーの 4 つのデータ センターです。ただし、一部の地域では、以下のデータ センター (インドの 3 つのデータ センターとオーストラリアと日本で 2 つのデータ センターにデータベースがレプリケートされます) があります。すべての場合、すべてのメールボックス データベースからソフトウェア、ハードウェア、およびデータ センターの障害も、メールボックスのデータが保護されていることを確認できるため、複数のデータ センターに分散された 4 つのコピーです。 

これら 4 つのコピーをこれらの 3 つ、高可用性アプリケーションとして構成されます。4 番目のコピーは、[データベースのコピーは遅れて](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies)として構成されます。被覆のデータベースのコピーは個々 のメールボックスのリカバリ、またはメールボックス アイテムのリカバリ用のものではありません。その目的は、システム全体にわたる、壊滅的な論理的な破損のまれなイベントの回復メカニズムを提供することです。 

被覆のデータベースのコピーを Exchange Online では、7 日間のログ ファイルの再生ラグ タイムで構成されます。さらに、自己修復し、ログ ファイルの拡張を管理する被覆のデータベースのコピーを許可する被覆のコピーのダウンの動的なログ ファイルの再生を提供する Exchange の再生ラグのマネージャーが有効になります。Exchange Online では、コピーを使用するデータベースは遅れて、それが保証されたポイント ・ イン ・ タイムのバックアップはないことを理解する重要です。Exchange Online の被覆のデータベースのコピーがある (自動再生を) のためにもコピー通常約 90%、時間帯と被覆のコピーを含むディスクがディスクに障害が、可用性の高い被覆のコピーが失われる可用性しきい値被覆のデータベースのコピー、ログの作成を再期間とは、キューを再生します。 

## <a name="transport-resilience"></a>トランスポート障害許容力 
Exchange オンライン 2 つのプライマリ トランスポートの復元機能が含まれています: シャドウの冗長性とセーフティ ネットです。シャドウの冗長性は、転送中には、メッセージの冗長コピーを維持します。セーフティ ネットは、メッセージが正常に配信された後に、メッセージの冗長コピーを維持します。 

シャドウの冗長性、各オンラインの Exchange トランスポート サーバーにより受信確認メッセージを送信側サーバーを正常に受信する前に受信する各メッセージのコピーになります。これにより、すべてのメッセージ トランスポート パイプラインで転送中に冗長です。Exchange Online と判断した場合、元のメッセージが転送中に失われたメッセージの冗長コピーを再送信します。 

セーフティ ネットは、メールボックス サーバー上のトランスポート サービスに関連付けられているトランスポート キューです。このキューは、サーバーが正常に処理されたメッセージのコピーを格納します。メールボックス データベースまたはサーバーの障害では、メールボックス データベースの最新のコピーをアクティブにする必要がある場合セーフティ ネットのキュー内のメッセージはメールボックス データベースの新しいアクティブ ・ コピーを自動的に再送信します。セーフティ ネットも冗長、単一点障害とトランスポートがなくなります。使用してプライマリのセーフティ ネットとシャドウのセーフティ ネットの概念、12 時間以上のプライマリのセーフティ ネットが利用できない場合、要求、シャドウの再送信要求になり、メッセージは、シャドウのセーフティ ネットの再配信を再送信します。

セーフティ ネットからのメッセージの再送信は Dag とメールボックスを管理する Microsoft Exchange レプリケーション サービスのアクティブ マネージャー コンポーネントが自動的に開始データベースのコピーです。セーフティ ネットからのメッセージを再送信するのには、手動による操作は必要ありません。 

## <a name="single-bit-correction"></a>1 ビット訂正 
ESE には、検出し、ハードウェア エラーの結果である (別名、シングル ビット フリップ) シングル ビット CRC エラーを解決するためのメカニズムが含まれていますなど物理的な破損を表しているようです。これらのエラーが発生すると、ESE は自動的にそれらを修正し、イベント ログにイベントをログに記録します。 

## <a name="online-database-scanning"></a>オンライン データベースをスキャン 
オンラインでのデータベース スキャン (*データベース チェックサム*とも呼ばれます) は、場所、ESE は、データベースの整合性チェックして各ページを参照し、確認ページの破損をプロセスです。主な目的は、物理的な破損および取得する検出されないトランザクションの操作によって失われるフラッシュを検出すること。データベースのスキャンでは、クラッシュの後のストアの操作も実行します。クラッシュのためにスペースをリークする可能性が、オンライン データベースのスキャンを検索し、失われた領域が回復します。システムは、7 日間に 1 回すべてのデータベースが完全にスキャンされているという前提で設計されています。 

## <a name="lost-flush-detection"></a>フラッシュの検出が失われる 
データベース書き込み操作を完了したものとして、ディスク ・ サブシステム/オペレーティング ・ システムが返される実際に書き込まれなかったするときに発生するロスト フラッシュ ディスク、または間違った場所に書き込まれました。インシデントのフラッシュが失われることができますの結果データの損失、ESE が失われたフラッシュを防ぐために、データベースの論理的破損の結果が含まれています失われたフラッシュ検出メカニズムにはです。データベース ・ ページが書き込まれるとパッシブ ・ コピーをアクティブ ・ コピーのフラッシュが失われるのチェックが実行されます。ロスト フラッシュが検出された場合、ESE は、プロセスの修正プログラムを適用するページを使用してプロセスを修復できます。 

## <a name="single-page-restore"></a>単一ページの復元 
別名*ページの修正プログラム*を、1 つのページ復元は、破損したデータベース ページは正常な状態のレプリカからの正常なコピーを置き換え自動プロセスです。破損ページの修復プロセスは、データベースのコピーは、アクティブかパッシブかどうかによって異なります。アクティブなデータベース コピーには、破損ページが検出されるとで、レプリカのいずれかからページをコピーして、コピーするページが完全に最新の状態にできます。これは、メールボックス データベースのレプリケーションの基になるログ ストリームに、ページに対する要求を配置することによって行います。レプリカには、ページ要求が発生したと同時に、要求元のデータベースのコピーをページのコピーを送信することによって応答します。単一ページ復元では、レプリカが現在オフラインになっている場合でも、レプリカからページを要求するのにはアクティブな非同期通信メカニズムも提供します。 

パッシブなデータベースのコピーに破損が発生した場合これらのコピーが常に、アクティブなコピーの背後にあるために、被覆のデータベースのコピーを含む、安全では常にアクティブ コピーからパッシブ ・ コピーを任意のページをコピーします。データベースのパッシブ コピーは性質上、可用性の高いプロセスの修正プログラムを適用します] ページで、実行中にログを再生することが中断されているが、ログのコピーは続行されます。データベースのパッシブ コピーは、破損したページのコピーをアクティブ コピーから取得、最大の必要なログ生成の要件に適合するログ ファイルがコピー検査、および破損したページの更新プログラムを適用するまで待機します。ページはパッチが適用されて、ログの再生が再開されます。プロセスは、被覆のデータベースが最初に違う状態を達成するために必要なすべてのログ ファイルを再生する点を除いて、被覆のデータベースのコピーでは、同じです。 

## <a name="mailbox-replication-service"></a>メールボックス レプリケーション サービス 
メールボックスの移動は、大規模な電子メール サービスの管理の重要な部分です。常に最新のテクノロジがあり、扱うため、メールボックスを管理しながらこの作業を実行するのには、エンジニアを可能にするシステムを調整すること、堅牢なハードウェアとバージョンのアップグレード透過的に移動ユーザー (オンラインの状態を維持することを確認します。プロセス) では、キーとメールボックスが巨大化を取得するよう、適切にプロセスをスケール アップすることを確認します。 

Exchange メールボックス レプリケーション サービス (MR) は、データベース間でメールボックスを移動する必要があります。移動中は、MR は、メールボックス内のすべての項目の整合性チェックを実行します。整合性に問題が見つかった場合、MR は、問題を解決またはメールボックスから削除、破損、破損したアイテムをスキップします。 

MR は Exchange のオンラインのコンポーネントであるため、ここを変更できるコードにアドレス新しいフォームの破損の後で検出されました。など MR で修正することはない、整合性に問題を検出している場合は分析破損、MR のコードを変更し、不整合を修正 (場合はここを理解する方法)。 

## <a name="log-file-checks"></a>ログ ファイルのチェック 
Exchange データベースによって生成されたすべてのトランザクション ログ ファイルには、整合性チェックのいくつかのフォームが行われます。ログ ファイルが作成されると、まず元に戻すは、ビット パターンが書かれており、一連のログの書き込みを実行し、します。これにより、一連のチェック (ロスト フラッシュ、CRC およびその他のチェック) には、書き込まれると、各ログ ファイルを検証するためを実行するために Exchange のオンラインおよびレプリケートされるときに、再度します。 

## <a name="deployment-on-resilient-file-system"></a>弾力性のあるファイル ・ システムの展開 
ファイル システム レベルで行われているから破損を防ぐため、Exchange のオンライン展開されている強化された回復機能を提供する弾力性のあるファイル システム (参照) のパーティションにします。参照は、ファイル ・ システムでは、Windows Server 2012 と後でデータの可用性と完全性が最大化するデータの破損に対する復元力を高めるために設計です。具体的には、参照は、改善の方法でメタデータを更新データの保護の強化を提供し、データが壊れている場合を削減します。ファイルのデータの整合性を検証するチェックサムを使用し、そのデータの破損を保証するメタデータが簡単に見つかり、修復します。 

Exchange オンライン参照の利点がいくつかの利点を受け取ります。 
- データの完全性の複数の復元機能より少ないデータの破損の問題を意味します。破損の問題の数を減らすことが少ないの不要なデータベースな再シードを意味します。 
- メタデータが壊れている場合の検出を有効にするより早く、確定的により、お客様のデータを修復することが可能で実行されているチェックサム データ ボリューム上に灰色の障害が発生する前に破損します。
- 非常に大きなデータ セットでうまく機能するよう設計されています-ペタバイト以上、パフォーマンスへの影響なし
- BitLocker 暗号化など、Exchange Online によって使用されるその他の機能をサポートします。 

Exchange オンラインできるという利点もその他の参照機能。 
- **整合性 (整合性のストリーム)** の参照は、通常データ損失の原因となる一般的なエラーの多くから保護する方法でデータを格納します。Office 365 の検索では、ディスクの破損を早期に検出し、ファイルの内容のチェックサムを支援する整合性のストリームを使用します。機能では、(書き込み操作が完了しない場合など、電源が停止したためです。)「破損書き込み」による破損事故も軽減されます。 
- **可用性 (修復)** を参照では、データの可用性を優先します。これまで、ファイル ・ システムは、修復のためオフラインにするシステムが必要となるデータの破損の影響を受けやすいことがよくありました。まれ、破損が発生した場合、参照実装を回収、ライブ ボリューム上の名前空間から破損したデータを削除し、正常なデータが悪影響を及ぼす影響を受けないこと・ リペア可能なデータの破損を保証する機能。回収機能を適用して、Exchange のオンライン データベース ・ ボリュームにデータの破損を分離することを置けばいいのよの影響を受けたデータベース破損したボリュームの破損と修復の操作の時刻の間で正常な状態を意味します。これは、通常このようなディスクの破損の問題によって影響を受けるデータベースの可用性を高めます。 