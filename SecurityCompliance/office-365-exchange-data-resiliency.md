---
title: Office 365 の Exchange データの復元
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
audience: ITPro
ms.topic: article
ms.service: Office 365 Administration
localization_priority: None
search.appverid:
- MET150
ms.collection: Strat_O365_Enterprise
description: Exchange オンラインおよび Office 365 内でのデータの復元のさまざまな側面の説明。
ms.openlocfilehash: 8d0448a95f010b766faf852a374513a1c2da61fa
ms.sourcegitcommit: 36c5466056cdef6ad2a8d9372f2bc009a30892bb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/27/2018
ms.locfileid: "22532043"
---
# <a name="exchange-online-data-resiliency-in-office-365"></a><span data-ttu-id="0547a-103">Office 365 で Exchange のオンライン ・ データのリカバリ性</span><span class="sxs-lookup"><span data-stu-id="0547a-103">Exchange Online Data Resiliency in Office 365</span></span>

## <a name="introduction"></a><span data-ttu-id="0547a-104">概要</span><span class="sxs-lookup"><span data-stu-id="0547a-104">Introduction</span></span>
<span data-ttu-id="0547a-p101">Exchange データベースに影響を与える破損の 2 種類があります: 物理的な破損は、通常が原因で、特定のストレージ ・ ハードウェア) のハードウェアの問題、およびその他の要因が原因で発生する、論理的な破損。一般は、Exchange データベース内で発生することが論理的な破損の 2 種類があります。</span><span class="sxs-lookup"><span data-stu-id="0547a-p101">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors. Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span> 
- <span data-ttu-id="0547a-p102">**データベースの論理的な破損**のページ上のデータが、データベース ページのチェックサムと一致問題が論理的にあります。これは、(拡張可能なストレージ エンジン (ESE)) データベース エンジンがデータベース ・ ページを作成しようとすると、オペレーティング システムには、成功メッセージが返される場合でも発生する可能性が、データも書き込まれることは、ディスクにするか、間違った場所に書き込まれます。これは*フラッシュが失われる*と呼ばれます。ESE には、多数の機能と、データベースおよびその他のデータ損失のシナリオの物理的な破損を防ぐために設計された保護機能が含まれています。失われたフラッシュを防ぐため、データを失うことから、ESE には、それを修正する機能 (単一ページの復元) とデータベースの失われたフラッシュ検出メカニズムが含まれます。</span><span class="sxs-lookup"><span data-stu-id="0547a-p102">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically. This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place. This is referred to as a *lost flush*. ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios. To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span> 
- <span data-ttu-id="0547a-p103">**ストアの論理的破損**からのデータが追加、削除、または、ユーザーが予期しない方法で操作します。このような場合は通常、サードパーティ製のアプリケーションで発生します。一般には、ユーザーを表示することが破損としての意味での破損のみです。Exchange ストアでは、一連の MAPI 操作を有効にする論理的な破損を生成したトランザクションと見なされます。Exchange Online で[インプレース保持](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds)機能は、(これにより、コンテンツが、ユーザーまたはアプリケーションが完全に削除される) ために、ストアの論理的破損から保護を提供します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p103">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect. These cases are generally caused by third-party applications. It's generally only corruption in the sense that the user views it as corruption. The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations. The [In-Place Hold](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="0547a-p104">Exchange Online は、ログを検査し、ログの再生時にレプリケートされたログ ・ ファイルのいくつかの整合性チェックを実行します。これらの整合性チェックは、システムによって複製されるを物理的な破損を防ぐためです。たとえば、ログの検査中には物理的な整合性チェック、ログ ファイルを確認し、ログ ファイルに記録されているチェックサムがメモリ内で生成されたチェックサムと一致しているかを検証します。さらに、ログ ファイルのログのヘッダーに記録されているログ ファイルの署名に一致するかどうかを確認するのには、ログ ファイルのヘッダーが調べられます。ログの再生中には、ログ ファイルと、審査の厳格化で実施さらにします。たとえば、データベース ヘッダーには、ログの署名と一致していることを確認するのにはログ ファイルの署名と比較するも含まれます。</span><span class="sxs-lookup"><span data-stu-id="0547a-p104">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay. These consistency checks prevent physical corruption from being replicated by the system. For example, during log inspection, there is a physical integrity check which verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory. In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file. During log replay, the log file undergoes further scrutiny. For example, the database header also contains the log signature which is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="0547a-p105">Exchange ネイティブ データ保護、アプリケーション ・ レベル ・ レプリケーションを活用して、複数のサーバー、およびその他の複数のデータ センター間で弾力性の戦略を使用して Exchange Online のメールボックス データの破損に対する保護を実現します。データ破損やその他の理由から失われるからデータを保護するための機能です。これらの機能には、次のように Microsoft または自体には、Exchange のオンラインのアプリケーションによって管理されているネイティブの機能があります。</span><span class="sxs-lookup"><span data-stu-id="0547a-p105">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons. These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="0547a-125">データ可用性グループ</span><span class="sxs-lookup"><span data-stu-id="0547a-125">Data Availability Groups</span></span>](https://docs.microsoft.com/exchange/back-up-email)
- <span data-ttu-id="0547a-126">1 ビット訂正</span><span class="sxs-lookup"><span data-stu-id="0547a-126">Single Bit Correction</span></span> 
- <span data-ttu-id="0547a-127">オンライン データベースをスキャン</span><span class="sxs-lookup"><span data-stu-id="0547a-127">Online Database Scanning</span></span> 
- <span data-ttu-id="0547a-128">フラッシュの検出が失われる</span><span class="sxs-lookup"><span data-stu-id="0547a-128">Lost Flush Detection</span></span> 
- <span data-ttu-id="0547a-129">単一ページの復元</span><span class="sxs-lookup"><span data-stu-id="0547a-129">Single Page Restore</span></span> 
- <span data-ttu-id="0547a-130">メールボックス レプリケーション サービス</span><span class="sxs-lookup"><span data-stu-id="0547a-130">Mailbox Replication Service</span></span> 
- <span data-ttu-id="0547a-131">ログ ファイルのチェック</span><span class="sxs-lookup"><span data-stu-id="0547a-131">Log File Checks</span></span> 
- <span data-ttu-id="0547a-132">弾力性のあるファイル ・ システムの展開</span><span class="sxs-lookup"><span data-stu-id="0547a-132">Deployment on Resilient File System</span></span> 

<span data-ttu-id="0547a-p106">上記のネイティブ機能の詳細については、上記のハイパーリンクをクリックして、関連情報とハイパーリンクなしのアイテムの詳細については、以下を参照してください。、これらのネイティブな機能だけでなく Exchange Online も含まれています、次のように顧客を管理するデータのリカバリ性能に関する機能。</span><span class="sxs-lookup"><span data-stu-id="0547a-p106">For more information on the native features listed above, click on the above hyperlinks, and see below for additional information and for details on items without hyperlinks. In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="0547a-135">(既定で有効になっている) 1 つのアイテムの復元</span><span class="sxs-lookup"><span data-stu-id="0547a-135">Single Item Recovery (enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="0547a-136">インプレース保持と訴訟ホールド</span><span class="sxs-lookup"><span data-stu-id="0547a-136">In-Place Hold and Litigation Hold</span></span>](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="0547a-137">削除済みアイテムの保持と Soft-Deleted のメールボックス (どちらも既定で有効になっている)</span><span class="sxs-lookup"><span data-stu-id="0547a-137">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="0547a-138">データベース可用性グループ</span><span class="sxs-lookup"><span data-stu-id="0547a-138">Database Availability Groups</span></span> 
<span data-ttu-id="0547a-p107">Office 365 内のすべてのメールボックス データベースは[データベース可用性グループ (DAG)](https://docs.microsoft.com/exchange/back-up-email)でホストされているし、同じ領域内にある地理的に別のデータ センターに複製します。最も一般的な構成は、4 つのデータベースのコピーの 4 つのデータ センターです。ただし、一部の地域では、以下のデータ センター (インドの 3 つのデータ センターとオーストラリアと日本で 2 つのデータ センターにデータベースがレプリケートされます) があります。すべての場合、すべてのメールボックス データベースからソフトウェア、ハードウェア、およびデータ センターの障害も、メールボックスのデータが保護されていることを確認できるため、複数のデータ センターに分散された 4 つのコピーです。</span><span class="sxs-lookup"><span data-stu-id="0547a-p107">Every mailbox database in Office 365 is hosted in a [database availability group (DAG)](https://docs.microsoft.com/exchange/back-up-email) and replicated to geographically-separate datacenters within the same region. The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan). But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="0547a-p108">これら 4 つのコピーをこれらの 3 つ、高可用性アプリケーションとして構成されます。4 番目のコピーは、[データベースのコピーは遅れて](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies)として構成されます。被覆のデータベースのコピーは個々 のメールボックスのリカバリ、またはメールボックス アイテムのリカバリ用のものではありません。その目的は、システム全体にわたる、壊滅的な論理的な破損のまれなイベントの回復メカニズムを提供することです。</span><span class="sxs-lookup"><span data-stu-id="0547a-p108">Out of these four copies, three of them are configured as highly available. The fourth copy is configured as a [lagged database copy](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies). The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery. Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="0547a-p109">被覆のデータベースのコピーを Exchange Online では、7 日間のログ ファイルの再生ラグ タイムで構成されます。さらに、自己修復し、ログ ファイルの拡張を管理する被覆のデータベースのコピーを許可する被覆のコピーのダウンの動的なログ ファイルの再生を提供する Exchange の再生ラグのマネージャーが有効になります。Exchange Online では、コピーを使用するデータベースは遅れて、それが保証されたポイント ・ イン ・ タイムのバックアップはないことを理解する重要です。Exchange Online の被覆のデータベースのコピーがある (自動再生を) のためにもコピー通常約 90%、時間帯と被覆のコピーを含むディスクがディスクに障害が、可用性の高い被覆のコピーが失われる可用性しきい値被覆のデータベースのコピー、ログの作成を再期間とは、キューを再生します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p109">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time. In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth. Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup. Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly-available copy (due to automatic play down), as well as the periods where the lagged database copy is re-building the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="0547a-150">トランスポート障害許容力</span><span class="sxs-lookup"><span data-stu-id="0547a-150">Transport Resilience</span></span> 
<span data-ttu-id="0547a-p110">Exchange オンライン 2 つのプライマリ トランスポートの復元機能が含まれています: シャドウの冗長性とセーフティ ネットです。シャドウの冗長性は、転送中には、メッセージの冗長コピーを維持します。セーフティ ネットは、メッセージが正常に配信された後に、メッセージの冗長コピーを維持します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p110">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net. Shadow Redundancy keeps a redundant copy of a message while it is in transit. Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="0547a-p111">シャドウの冗長性、各オンラインの Exchange トランスポート サーバーにより受信確認メッセージを送信側サーバーを正常に受信する前に受信する各メッセージのコピーになります。これにより、すべてのメッセージ トランスポート パイプラインで転送中に冗長です。Exchange Online と判断した場合、元のメッセージが転送中に失われたメッセージの冗長コピーを再送信します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p111">With Shadow Redundancy, each Exchange Online transport server makes a copy of each messages it receives before it acknowledges successfully receiving the message to the sending server. This makes all messages in the transport pipeline redundant while in transit. If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="0547a-p112">セーフティ ネットは、メールボックス サーバー上のトランスポート サービスに関連付けられているトランスポート キューです。このキューは、サーバーが正常に処理されたメッセージのコピーを格納します。メールボックス データベースまたはサーバーの障害では、メールボックス データベースの最新のコピーをアクティブにする必要がある場合セーフティ ネットのキュー内のメッセージはメールボックス データベースの新しいアクティブ ・ コピーを自動的に再送信します。セーフティ ネットも冗長、単一点障害とトランスポートがなくなります。使用してプライマリのセーフティ ネットとシャドウのセーフティ ネットの概念、12 時間以上のプライマリのセーフティ ネットが利用できない場合、要求、シャドウの再送信要求になり、メッセージは、シャドウのセーフティ ネットの再配信を再送信します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p112">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server. This queue stores copies of messages that were successfully processed by the server. When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database. Safety Net is also redundant, thereby eliminating transport as a single point of failure. It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are re-delivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="0547a-p113">セーフティ ネットからのメッセージの再送信は Dag とメールボックスを管理する Microsoft Exchange レプリケーション サービスのアクティブ マネージャー コンポーネントが自動的に開始データベースのコピーです。セーフティ ネットからのメッセージを再送信するのには、手動による操作は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="0547a-p113">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies. No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="0547a-164">1 ビット訂正</span><span class="sxs-lookup"><span data-stu-id="0547a-164">Single Bit Correction</span></span> 
<span data-ttu-id="0547a-p114">ESE には、検出し、ハードウェア エラーの結果である (別名、シングル ビット フリップ) シングル ビット CRC エラーを解決するためのメカニズムが含まれていますなど物理的な破損を表しているようです。これらのエラーが発生すると、ESE は自動的にそれらを修正し、イベント ログにイベントをログに記録します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p114">ESE includes a mechanism to detect and resolve single-bit CRC errors (aka single-bit flips) that are the result of hardware errors (and as such they represent physical corruption). When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="0547a-167">オンライン データベースをスキャン</span><span class="sxs-lookup"><span data-stu-id="0547a-167">Online Database Scanning</span></span> 
<span data-ttu-id="0547a-p115">オンラインでのデータベース スキャン (*データベース チェックサム*とも呼ばれます) は、場所、ESE は、データベースの整合性チェックして各ページを参照し、確認ページの破損をプロセスです。主な目的は、物理的な破損および取得する検出されないトランザクションの操作によって失われるフラッシュを検出すること。データベースのスキャンでは、クラッシュの後のストアの操作も実行します。クラッシュのためにスペースをリークする可能性が、オンライン データベースのスキャンを検索し、失われた領域が回復します。システムは、7 日間に 1 回すべてのデータベースが完全にスキャンされているという前提で設計されています。</span><span class="sxs-lookup"><span data-stu-id="0547a-p115">Online database scanning (also known as *database checksumming*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption. The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations. Database scanning also performs post-store crash operations. Space can be leaked due to crashes, and online database scanning finds and recovers lost space. The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="0547a-173">フラッシュの検出が失われる</span><span class="sxs-lookup"><span data-stu-id="0547a-173">Lost Flush Detection</span></span> 
<span data-ttu-id="0547a-p116">データベース書き込み操作を完了したものとして、ディスク ・ サブシステム/オペレーティング ・ システムが返される実際に書き込まれなかったするときに発生するロスト フラッシュ ディスク、または間違った場所に書き込まれました。インシデントのフラッシュが失われることができますの結果データの損失、ESE が失われたフラッシュを防ぐために、データベースの論理的破損の結果が含まれています失われたフラッシュ検出メカニズムにはです。データベース ・ ページが書き込まれるとパッシブ ・ コピーをアクティブ ・ コピーのフラッシュが失われるのチェックが実行されます。ロスト フラッシュが検出された場合、ESE は、プロセスの修正プログラムを適用するページを使用してプロセスを修復できます。</span><span class="sxs-lookup"><span data-stu-id="0547a-p116">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location. Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism. As database pages are written to passive copies, a check is performed for lost flushes on the active copy. If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="0547a-178">単一ページの復元</span><span class="sxs-lookup"><span data-stu-id="0547a-178">Single Page Restore</span></span> 
<span data-ttu-id="0547a-p117">別名*ページの修正プログラム*を、1 つのページ復元は、破損したデータベース ページは正常な状態のレプリカからの正常なコピーを置き換え自動プロセスです。破損ページの修復プロセスは、データベースのコピーは、アクティブかパッシブかどうかによって異なります。アクティブなデータベース コピーには、破損ページが検出されるとで、レプリカのいずれかからページをコピーして、コピーするページが完全に最新の状態にできます。これは、メールボックス データベースのレプリケーションの基になるログ ストリームに、ページに対する要求を配置することによって行います。レプリカには、ページ要求が発生したと同時に、要求元のデータベースのコピーをページのコピーを送信することによって応答します。単一ページ復元では、レプリカが現在オフラインになっている場合でも、レプリカからページを要求するのにはアクティブな非同期通信メカニズムも提供します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p117">Single page restore, aka *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica. The repair process for a corrupt page depends on whether the database copy is active or passive. When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is completely up-to-date. This is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication. As soon as a replica encounters the page request it responds by sending a copy of the page to the requesting database copy. Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="0547a-p118">パッシブなデータベースのコピーに破損が発生した場合これらのコピーが常に、アクティブなコピーの背後にあるために、被覆のデータベースのコピーを含む、安全では常にアクティブ コピーからパッシブ ・ コピーを任意のページをコピーします。データベースのパッシブ コピーは性質上、可用性の高いプロセスの修正プログラムを適用します] ページで、実行中にログを再生することが中断されているが、ログのコピーは続行されます。データベースのパッシブ コピーは、破損したページのコピーをアクティブ コピーから取得、最大の必要なログ生成の要件に適合するログ ファイルがコピー検査、および破損したページの更新プログラムを適用するまで待機します。ページはパッチが適用されて、ログの再生が再開されます。プロセスは、被覆のデータベースが最初に違う状態を達成するために必要なすべてのログ ファイルを再生する点を除いて、被覆のデータベースのコピーでは、同じです。</span><span class="sxs-lookup"><span data-stu-id="0547a-p118">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy. A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues. The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file which meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page. Once the page has been patched, log replay resumes. The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="0547a-190">メールボックス レプリケーション サービス</span><span class="sxs-lookup"><span data-stu-id="0547a-190">Mailbox Replication Service</span></span> 
<span data-ttu-id="0547a-p119">メールボックスの移動は、大規模な電子メール サービスの管理の重要な部分です。常に最新のテクノロジがあり、扱うため、メールボックスを管理しながらこの作業を実行するのには、エンジニアを可能にするシステムを調整すること、堅牢なハードウェアとバージョンのアップグレード透過的に移動ユーザー (オンラインの状態を維持することを確認します。プロセス) では、キーとメールボックスが巨大化を取得するよう、適切にプロセスをスケール アップすることを確認します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p119">Moving mailboxes is a key part of managing a large-scale email service. There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="0547a-p120">Exchange メールボックス レプリケーション サービス (MR) は、データベース間でメールボックスを移動する必要があります。移動中は、MR は、メールボックス内のすべての項目の整合性チェックを実行します。整合性に問題が見つかった場合、MR は、問題を解決またはメールボックスから削除、破損、破損したアイテムをスキップします。</span><span class="sxs-lookup"><span data-stu-id="0547a-p120">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases. During the move, MRS performs a consistency check on all items within the mailbox. If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="0547a-p121">MR は Exchange のオンラインのコンポーネントであるため、ここを変更できるコードにアドレス新しいフォームの破損の後で検出されました。など MR で修正することはない、整合性に問題を検出している場合は分析破損、MR のコードを変更し、不整合を修正 (場合はここを理解する方法)。</span><span class="sxs-lookup"><span data-stu-id="0547a-p121">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future. For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="0547a-198">ログ ファイルのチェック</span><span class="sxs-lookup"><span data-stu-id="0547a-198">Log File Checks</span></span> 
<span data-ttu-id="0547a-p122">Exchange データベースによって生成されたすべてのトランザクション ログ ファイルには、整合性チェックのいくつかのフォームが行われます。ログ ファイルが作成されると、まず元に戻すは、ビット パターンが書かれており、一連のログの書き込みを実行し、します。これにより、一連のチェック (ロスト フラッシュ、CRC およびその他のチェック) には、書き込まれると、各ログ ファイルを検証するためを実行するために Exchange のオンラインおよびレプリケートされるときに、再度します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p122">All transaction log files generated by an Exchange database undergo several forms of consistency checks. When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed. This enables Exchange Online to execute a series of checks (lost flush, CRC and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="0547a-202">弾力性のあるファイル ・ システムの展開</span><span class="sxs-lookup"><span data-stu-id="0547a-202">Deployment on Resilient File System</span></span> 
<span data-ttu-id="0547a-p123">ファイル システム レベルで行われているから破損を防ぐため、Exchange のオンライン展開されている強化された回復機能を提供する弾力性のあるファイル システム (参照) のパーティションにします。参照は、ファイル ・ システムでは、Windows Server 2012 と後でデータの可用性と完全性が最大化するデータの破損に対する復元力を高めるために設計です。具体的には、参照は、改善の方法でメタデータを更新データの保護の強化を提供し、データが壊れている場合を削減します。ファイルのデータの整合性を検証するチェックサムを使用し、そのデータの破損を保証するメタデータが簡単に見つかり、修復します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p123">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities. ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity. Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases. It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="0547a-207">Exchange オンライン参照の利点がいくつかの利点を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="0547a-207">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="0547a-p124">データの完全性の複数の復元機能より少ないデータの破損の問題を意味します。破損の問題の数を減らすことが少ないの不要なデータベースな再シードを意味します。</span><span class="sxs-lookup"><span data-stu-id="0547a-p124">More resiliency in data integrity means fewer data corruption incidents. Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="0547a-210">メタデータが壊れている場合の検出を有効にするより早く、確定的により、お客様のデータを修復することが可能で実行されているチェックサム データ ボリューム上に灰色の障害が発生する前に破損します。</span><span class="sxs-lookup"><span data-stu-id="0547a-210">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="0547a-211">非常に大きなデータ セットでうまく機能するよう設計されています-ペタバイト以上、パフォーマンスへの影響なし</span><span class="sxs-lookup"><span data-stu-id="0547a-211">Designed to work well with extremely large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="0547a-212">BitLocker 暗号化など、Exchange Online によって使用されるその他の機能をサポートします。</span><span class="sxs-lookup"><span data-stu-id="0547a-212">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="0547a-213">Exchange オンラインできるという利点もその他の参照機能。</span><span class="sxs-lookup"><span data-stu-id="0547a-213">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="0547a-p125">**整合性 (整合性のストリーム)** の参照は、通常データ損失の原因となる一般的なエラーの多くから保護する方法でデータを格納します。Office 365 の検索では、ディスクの破損を早期に検出し、ファイルの内容のチェックサムを支援する整合性のストリームを使用します。機能では、(書き込み操作が完了しない場合など、電源が停止したためです。)「破損書き込み」による破損事故も軽減されます。</span><span class="sxs-lookup"><span data-stu-id="0547a-p125">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss. Office 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content. The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="0547a-p126">**可用性 (修復)** を参照では、データの可用性を優先します。これまで、ファイル ・ システムは、修復のためオフラインにするシステムが必要となるデータの破損の影響を受けやすいことがよくありました。まれ、破損が発生した場合、参照実装を回収、ライブ ボリューム上の名前空間から破損したデータを削除し、正常なデータが悪影響を及ぼす影響を受けないこと・ リペア可能なデータの破損を保証する機能。回収機能を適用して、Exchange のオンライン データベース ・ ボリュームにデータの破損を分離することを置けばいいのよの影響を受けたデータベース破損したボリュームの破損と修復の操作の時刻の間で正常な状態を意味します。これは、通常このようなディスクの破損の問題によって影響を受けるデータベースの可用性を高めます。</span><span class="sxs-lookup"><span data-stu-id="0547a-p126">**Availability (Salvage)** - ReFS prioritizes the availability of data. Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair. Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data. Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action. This increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 