---
title: Exchange Online Protection のメール フロー ルール (トランスポート ルール)
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 4/29/2017
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: 9c2cf227-eff7-48ef-87fb-487186e47363
description: メールフロールール (トランスポートルール) を使用して、Office 365 組織を通過するメッセージを識別し、処理を行うことができます。
ms.openlocfilehash: a08d3ff0d976def1d104c99a9532fe5c826f0523
ms.sourcegitcommit: 90e514177a1ee6b7485334b15c588b0ac906aa26
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/05/2019
ms.locfileid: "34726058"
---
# <a name="mail-flow-rules-transport-rules-in-exchange-online-protection"></a>Exchange Online Protection のメール フロー ルール (トランスポート ルール)

メール フロー ルール (別名トランスポート ルール) は、Office 365 組織を通過するメッセージを識別し、アクションを実行するために使用できます。メール フロー ルールは、Outlook および Web 上の Outlook で使用できる受信トレイ ルールに似ています。最大の違いは、メール フロー ルールがメールボックスにメッセージが届いた後ではなく、配送中のメッセージに対しアクションを実行するということです。メール フロー ルールにはより多くの条件、例外、アクションが含まれるため、多種多様なメッセージング ポリシーを柔軟に実装することができます。
  
この記事では、メール フロー ルールのコンポーネントとその機能について説明します。
  
メールフロールールを作成、コピー、管理する手順については、「**メールフロールールの管理**」を参照してください。 ルールごとに、ルールを適用、ルールをテスト、ルールをテストして送信者に通知するという、いずれかのオプションを選択できます。 テストのオプションについては、「 **Test a transport rule**」および「 **Policy Tips**」を参照してください。
  
メール フロー ルールに一致したメッセージに関する概要と詳細のレポートについては、「**Office 365 のメール保護レポートによるマルウェア、スパム、ルールの検出に関するデータ表示**」をご覧ください。
  
メール フロー ルールを使用して特定のメッセージング ポリシーを実装するには、次のトピックを参照してください。
  
- [Office 365 で、メール フロー ルールを使用してメッセージの添付ファイルを検査する](http://technet.microsoft.com/library/874d1c78-a8ec-4938-b388-d3208c2fa971.aspx)
    
- [Office 365 Enterprise で暗号化を設定する](https://support.office.com/article/e86fc991-0161-4f01-9c1c-d25e87733d06)
    
- [Office 365 における組織全体のメッセージの免責事項、署名、フッター、ヘッダー](http://technet.microsoft.com/library/29ac61c2-77f1-4071-b14e-8cc64e3e76ba.aspx)
    
- [メール フロー ルールを使用して、メッセージの Spam Confidence Level (SCL) を設定する](../use-mail-flow-rules-to-set-the-spam-confidence-level-scl-in-messages.md)
    
- [Office 365 で受信拒否リストを作成する](../create-block-sender-lists-in-office-365.md)
    
- [Exchange Online Protection でファイルの添付のブロックを通じてマルウェアの脅威を削減する](reducing-malware-threats-through-file-attachment-blocking-in-exchange-online-pro.md)
    
- [電子メール メッセージの暗号化または暗号化解除ルールの定義](https://go.microsoft.com/fwlink/p/?Linkid=402846)
    
次のビデオは、Exchange Online Protection でのメールフロールールの設定のデモを示しています。
  
> [!VIDEO https://www.microsoft.com/videoplayer/embed/7cdcd2cb-9382-4065-98e1-81257b32a189?autoplay=false]
  
## <a name="mail-flow-rule-components"></a>メール フロー ルールの構成要素

メール フロー ルールは条件、例外、アクション、プロパティからできています。
  
- **[条件]** アクションを適用するメッセージを特定します。一部の条件は、メッセージ ヘッダー フィールド (例、宛先、差出人、または CC フィールド) を確認します。その他の条件はメッセージ プロパティ (例、メッセージの件名、本文、添付ファイル、メッセージ サイズ、またはメッセージ分類) を確認します。ほとんどの条件は、比較演算子 (例、次と一致する、次と一致しない、または次が含まれる) と一致する値を指定する必要があります。条件または例外が 1 つもない場合、ルールはすべてのメッセージに適用されます。 
    
    Exchange Online Protection におけるメールフロールールの条件の詳細については、「 [Exchange online でのメールフロールールの条件と例外 (述語)](https://docs.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)」を参照してください。
    
- **[例外]** アクションが適用されないメッセージを任意で特定します。条件で使用可能なメッセージ識別子と同じものが、例外でも使用可能です。例外は条件より優先され、メッセージが構成されているすべての条件に一致していても、そのメッセージにルール アクションが適用されないようにします。 
    
- **[アクション]** ルールの条件に一致し、いずれの例外にも一致しないメッセージに対して行うことを指定します。使用できるアクションには、メッセージの拒否、削除、またはリダイレクト、受信者の追加、メッセージの件名へのプレフィックスの追加、またはメッセージ本文への免責事項の挿入など、多数のものがあります。 
    
    Exchange Online Protection で使用可能なメールフロールールの処理の詳細については、「 [Exchange Online protection のメールフロールールのアクション](http://technet.microsoft.com/library/f8621ecb-a177-4025-9011-a6569999746a.aspx)」を参照してください。
    
- **[プロパティ]** その他のルールの設定で、条件、例外、またはアクションではないものを指定します。たとえば、いつルールを適用するか、ルールを強制するか、あるいはテストするかどうか、およびルールを有効化する期間などです。 
    
      詳細に関しては、このトピックの「[メール フロー ルールのプロパティ](mail-flow-rules-transport-rules-0.md#Properties)」セクションを参照してください。 
    
### <a name="multiple-conditions-exceptions-and-actions"></a>複数の条件、例外、アクション

次の表は、複数の条件、条件の値、例外、アクションが、ルールでどのように処理されるのかを説明しています。
  
|**コンポーネント**|**ロジック**|**コメント**|
|:-----|:-----|:-----|
|コメント  <br/> |AND  <br/> |メッセージは、ルールのすべての条件に一致しなければなりません。別々の条件に一致させる必要がある場合は、条件ごとに個別のルールを使用します。たとえば、ファイルが添付されたメッセージと、特定のテキストを含んでいるメッセージに同じ免責事項を追加するには、それぞれの条件ごとに 1 つのルールを作成します。EAC においては、ルールは簡単にコピーできます。  <br/> |
|メッセージは、ルールのすべての条件に一致しなければなりません。別々の条件に一致させる必要がある場合は、条件ごとに個別のルールを使用します。たとえば、ファイルが添付されたメッセージと、コンテンツがパターンと一致するメッセージに同じ免責事項を追加するには、それぞれの条件ごとに 1 つのルールを作成します。ルールは簡単にコピーできます。  <br/> |OR  <br/> |条件によっては、複数の値を指定できる場合もあります。メッセージは指定された値の任意の 1 つ (すべてではない) に一致する必要があります。たとえば、メール メッセージの件名が「株価情報」で、 **[件名に次のいずれかの語が含まれている場合]** という条件が「 Contoso」または「株」のいずれかの単語に一致するよう構成されていたとすると、件名に値が少なくとも 1 つは含まれているので、この条件は満たされています。  <br/> |
|条件によっては、複数の値を指定できる場合もあります。1 つの条件に複数の値を入力できる場合、メッセージはその条件で指定された値のいずれかに一致する必要があります。たとえば、メール メッセージの件名が「株価情報」で、トランスポート ルールの [件名に次のいずれかの語が含まれている場合] という条件が「Contoso」または「株」のいずれかの単語に一致するよう構成されていたとすると、件名に条件の値が少なくとも 1 つは含まれているので、この条件は満たされています。  <br/> |または  <br/> |メッセージがいずれか 1 つの例外に一致すると、アクションはメッセージに適用されません。メッセージがすべての例外に一致する必要はありません。  <br/> |
|メッセージがいずれかの例外に一致すると、アクションは実行されません。メッセージが、すべての例外に一致する必要はありません。  <br/> |および  <br/> |ルールの条件に一致するメッセージには、ルールに指定されるすべてのアクションが実行されます。たとえば、 **[メッセージの件名の先頭に付加する]** というアクションと、 **[受信者を BCC ボックスに追加する]** というアクションが選択されている場合、両方のアクションがメッセージに適用されます。  <br/> ルールの条件に一致するメッセージには、そのルールで指定されたすべてのアクションが実行されます。たとえば、[メッセージの件名の先頭に付加する] というアクションと、[受信者を BCC ボックスに追加する] というアクションが選択されている場合、両方のアクションがメッセージに適用されます。メッセージには、メッセージの件名の先頭に指定の文字列が追加され、指定された受信者が BCC 受信者として追加されます。<br/> ルールにアクションを設定して、そのルールが適用されたときに、メッセージにそれ以降のルールの適用されないようにすることもできます。  <br/> |
   
### <a name="mail-flow-rule-properties"></a>メール フロー ルールのプロパティ
<a name="Properties"> </a>

次の表で、メール フロー ルールで使用可能なルールのプロパティについて説明します。
  
|**EAC におけるプロパティ名**|**PowerShell におけるパラメーター名**|**説明**|
|:-----|:-----|:-----|
|**[優先度]** <br/> | _Priority_ <br/> |メッセージにルールを適用する順番を示します。優先度の既定値はルールの作成時期に基づいています (古いルールのほうが新しいルールより優先度が高く、優先度の高いルールが優先度の低いルールよりも先に処理されます)。    <br/> EAC 内でのルールの優先度は、ルール一覧内でそのルールを上下に移動させることで変更します。PowerShell では、優先度番号を設定します (0 が最高優先度)。    <br/> たとえば、クレジット カード番号が含まれるメッセージを拒否するルールと、承認を必要とする別のルールがある場合、拒否のルールを最初に適用して、他のルールの適用を停止する必要があります。  |
|**[モード]** <br/> | _Mode_ <br/> |ルールにすぐにメッセージの処理を開始させるか、あるいはメッセージの配信に影響を与えずにルールをテストするかどうかを指定することができます (データ紛失防止、DLP ポリシー ヒントの有無を問わず)。  <br/> ポリシー ヒントは、メッセージを作成しているユーザーにそれがポリシー違反の可能性があることを通知する短いメモを、Outlook または Web 上の Outlook で提示します。詳細については、「 **Policy Tips** 」を参照してください。  <br/> モードの詳細については、「 **Test a mail flow rule** 」を参照してください。  <br/> |
|**次の日付でこのルールを有効にする** <br/> **次の日付に、このルールを無効にする** <br/> | _ActivationDate_ <br/>  _ExpiryDate_ <br/> |ルールが有効化される日付の範囲を指定します。  <br/> |
|選択されているかどうかに関わらず、チェック ボックスを **オン** にします。  <br/> |新しいルール: _New-TransportRule_ コマンドレットの  **Enabled** パラメーター。  <br/> 既存のルール: **Enable-TransportRule** または **Disable-TransportRule** コマンドレットを使用します。  <br/> 値はルールの **State** プロパティに表示されます。  <br/> |無効なルールを作成して、それをテストする準備ができたときに有効にすることができます。または、設定を保持するために削除することなくルールを無効にすることができます  <br/> |
|**[ルール処理が完了しない場合メッセージを優先する]** <br/> | _RuleErrorAction_ <br/> |ルール処理が完了しない場合にメッセージをどのように扱うかを指定することができます。既定値ではルールは無視されますが、処理のためにメッセージを再送信することを選択できます。  <br/> |
|**メッセージの送信者アドレスを一致** <br/> | _SenderAddressLocation_ <br/> |ルールが送信者のメール アドレスを確認する例外や条件を使用する場合、メッセージ ヘッダー、メッセージのエンベロープ、またはその両方の値を検索できます。  <br/> |
|**[ルールの処理を中止する]** <br/> | _SenderAddressLocation_ <br/> |これはルールのアクションですが、EAC でのプロパティのように見えます。ルールがメッセージを処理した後に、追加のルールが適用されないように選択できます。  <br/> |
|**コメント** <br/> | _Comments_ <br/> |ルールに関する説明的なコメントを入力することができます。  <br/> |
   
## <a name="how-mail-flow-rules-are-applied-to-messages"></a>メッセージへのメール フロー ルールの適用方法

組織を通過するすべてのメッセージが、組織内の有効にされているメール フロー ルールについて評価されます。ルールが処理される順序は、EAC の **[メール フロー]** \> **[ルール]** ページでリストされている順、または PowerShell 内の対応する  _Priority_ パラメーターの値に基づきます。 
  
各ルールでは、そのルールが一致した場合に、以降のルールの処理を停止するオプションを選択できます。この設定は、メッセージが複数のメール フロー ルールの条件に一致する場合に重要です (メッセージにどのルールを適用しますか?すべてですか?1 つだけですか?)。
  
### <a name="differences-in-processing-based-on-message-type"></a>メッセージの種類による処理の違い

組織を通過するメッセージにはいくつかの種類があります。次の表に、メール フロー ルールで処理できるメッセージの種類を示します。
  
****

|**メッセージの種類**|**ルールを適用可能か**|
|:-----|:-----|
|**[通常のメッセージ]** 単一のリッチ テキスト形式 (RTF)、HTML、プレーン テキストのメッセージ本文あるいはメッセージ本文のマルチパートまたは代替セットが含まれるメッセージ。  <br/> |はい  <br/> |
|**Office 365 Message Encryption ** Office 365 の Office 365 Message Encryption によって暗号化されたメッセージ。詳細については、「 [Office 365 での暗号化](https://go.microsoft.com/fwlink/p/?LinkId=392525)」を参照してください。  <br/> |ルールは常にエンベロープ ヘッダーにアクセスでき、それらのヘッダーを検査する条件に基づいてメッセージを処理できます。  <br/> 暗号化されたメッセージのコンテンツをルールで検査または変更する場合、トランスポート復号化が有効になっていることを確認する必要があります (必須または省略可能。既定は省略可能です)。詳細については、「[トランスポート解読を有効または無効にする](https://go.microsoft.com/fwlink/p/?linkid=848060)」を参照してください。  <br/> 暗号化されたメッセージを自動的に復号化するルールを作成することもできます。詳細については、「[電子メール メッセージの暗号化または暗号化解除ルールの定義](https://go.microsoft.com/fwlink/p/?Linkid=402846)」を参照してください。  <br/> |
|**S/MIME 暗号化されたメッセージ** <br/> |ルールは、エンベロープ ヘッダーにのみアクセスでき、それらのヘッダーを検査する条件に基づいてメッセージを処理できます。  <br/> メッセージ コンテンツの検査を必要とする条件を使用したルール、またはメッセージのコンテンツを変更するアクションを処理することはできません。  <br/> |
|**RMS 保護されたメッセージ** Active Directory Rights Management サービス (AD RMS) または Azure Rights Management (RMS) ポリシーが適用されたメッセージ。  <br/> |ルールは常にエンベロープ ヘッダーにアクセスでき、それらのヘッダーを検査する条件に基づいてメッセージを処理できます。  <br/> RMS で保護されたメッセージのコンテンツをルールで検査または変更する場合、トランスポート復号化が有効になっていることを確認する必要があります (必須または省略可能。既定は省略可能です)。詳細については、「[トランスポート解読を有効または無効にする](https://go.microsoft.com/fwlink/p/?linkid=848060)」を参照してください。  <br/> |
|**[クリア署名付きメッセージ]** 署名されているが、暗号化はされていないメッセージ。  <br/> |はい  <br/> |
|**[UM メッセージ]** ボイス メール、ファックス、不在着信通知などのユニファイド メッセージング サービスによって作成または処理されたメッセージ、および Microsoft Outlook Voice Access を使用して転送されたメッセージ。  <br/> |はい  <br/> |
|**[匿名メッセージ]** 匿名の送信者によって送信されたメッセージ。  <br/> |はい  <br/> |
|**[開封済みレポート]** 送信者による開封要求確認を読み取るために生成されたレポート。開封済みレポートには、  `IPM.Note*.MdnRead` または  `IPM.Note*.MdnNotRead` のメッセージ クラスがあります。  <br/> |はい  <br/> |
   
## <a name="what-else-should-i-know"></a>その他の注意事項

- ルールの**バージョン**または**ruleversion**プロパティの値は、Exchange Online Protection では重要ではありません。 
    
- メール フロー ルールを作成または変更した後に、新規または更新されたルールがメッセージに適用されるまで、最大で 30 分かかります。
    
## <a name="for-more-information"></a>詳細情報
  
[メールフロールールを使用して Exchange Online のメッセージの添付ファイルを検査する](http://technet.microsoft.com/library/874d1c78-a8ec-4938-b388-d3208c2fa971.aspx)
  
[Office 365 での電子メールの暗号化](https://support.office.com/article/c0d87cbe-6d65-4c03-88ad-5216ea5564e8)
  
[ジャーナル、トランスポート、受信トレイのルール上の制限](https://go.microsoft.com/fwlink/p/?LinkId=324584)
