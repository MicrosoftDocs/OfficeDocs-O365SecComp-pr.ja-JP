---
title: Exchange Online Protection のメール フロー ルール (トランスポート ルール)
ms.author: tracyp
author: MSFTTracyP
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: 9c2cf227-eff7-48ef-87fb-487186e47363
description: メールフロールール (トランスポートルール) を使用して、Office 365 組織を通過するメッセージを識別し、処理を行うことができます。
ms.openlocfilehash: ba3ccbc765ce332c50af43ad3cd59bb73b7b7f54
ms.sourcegitcommit: 361aab46b1bb295ed2dcc1a417ac81f699b8ff78
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/30/2019
ms.locfileid: "36676687"
---
# <a name="mail-flow-rules-transport-rules-in-exchange-online-protection"></a>Exchange Online Protection のメール フロー ルール (トランスポート ルール)

メール フロー ルール (別名トランスポート ルール) は、Office 365 組織を通過するメッセージを識別し、アクションを実行するために使用できます。メール フロー ルールは、Outlook および Web 上の Outlook で使用できる受信トレイ ルールに似ています。最大の違いは、メール フロー ルールがメールボックスにメッセージが届いた後ではなく、配送中のメッセージに対しアクションを実行するということです。メール フロー ルールにはより多くの条件、例外、アクションが含まれるため、多種多様なメッセージング ポリシーを柔軟に実装することができます。
  
この記事では、メール フロー ルールのコンポーネントとその機能について説明します。
  
メールフロールールを作成、コピー、管理する手順については、「 [Exchange Online でメールフロールールを管理](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/manage-mail-flow-rules)する」を参照してください。 ルールごとに、ルールを適用、ルールをテスト、ルールをテストして送信者に通知するという、いずれかのオプションを選択できます。 テストオプションの詳細については、「 [Exchange Online の](https://docs.microsoft.com/exchange/security-and-compliance/data-loss-prevention/policy-tips)[メールフロールール](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/test-mail-flow-rules)とポリシーヒントをテストする」を参照してください。
  
メール フロー ルールに一致したメッセージに関する概要と詳細のレポートについては、「[Office 365 のメール保護レポートによるマルウェア、スパム、ルールの検出に関するデータ表示](https://docs.microsoft.com/exchange/monitoring/use-mail-protection-reports)」をご覧ください。
  
メール フロー ルールを使用して特定のメッセージング ポリシーを実装するには、次のトピックを参照してください。
  
- [メールフロールールを使用して Exchange Online のメッセージの添付ファイルを検査する](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/inspect-message-attachments)

- [Office 365 Enterprise で暗号化を設定する](../set-up-encryption.md)

- [Exchange Online の組織全体のメッセージの免責事項、署名、フッター、またはヘッダー](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/disclaimers-signatures-footers-or-headers)

- [メール フロー ルールを使用して、メッセージの Spam Confidence Level (SCL) を設定する](../use-mail-flow-rules-to-set-the-spam-confidence-level-scl-in-messages.md)

- [Office 365 で受信拒否リストを作成する](../create-block-sender-lists-in-office-365.md)

- [Exchange Online Protection でファイルの添付のブロックを通じてマルウェアの脅威を削減する](reducing-malware-threats-through-file-attachment-blocking-in-exchange-online-pro.md)

- [電子メール メッセージの暗号化または暗号化解除ルールの定義](https://go.microsoft.com/fwlink/p/?Linkid=402846)

次のビデオは、Exchange Online Protection でのメールフロールールの設定のデモを示しています。
  
> [!VIDEO https://www.microsoft.com/videoplayer/embed/7cdcd2cb-9382-4065-98e1-81257b32a189?autoplay=false]
  
## <a name="mail-flow-rule-components"></a>メール フロー ルールの構成要素

メール フロー ルールは条件、例外、アクション、プロパティからできています。
  
- **条件**: アクションを適用するメッセージを識別します。 一部の条件は、メッセージ ヘッダー フィールド (例、宛先、差出人、または CC フィールド) を確認します。 その他の条件はメッセージ プロパティ (例、メッセージの件名、本文、添付ファイル、メッセージ サイズ、またはメッセージ分類) を確認します。 ほとんどの条件は、比較演算子 (例、次と一致する、次と一致しない、または次が含まれる) と一致する値を指定する必要があります。 条件または例外が 1 つもない場合、ルールはすべてのメッセージに適用されます。 

Exchange Online Protection におけるメールフロールールの条件の詳細については、「 [Exchange online でのメールフロールールの条件と例外 (述語)](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)」を参照してください。

- **例外**: アクションが適用されないメッセージを指定します (オプション)。 条件で使用可能なメッセージ識別子と同じものが、例外でも使用可能です。 例外は条件より優先され、メッセージが構成されているすべての条件に一致していても、そのメッセージにルール アクションが適用されないようにします。 

- **Actions**: ルールの条件に一致するメッセージに対して行う操作を指定し、いずれの例外にも一致しないようにします。 例外は条件より優先され、メッセージが構成されているすべての条件に一致していても、そのメール メッセージにアクションが適用されないようにします。 

Exchange Online Protection で使用可能なメールフロールールの処理の詳細については、「 [Exchange online のメールフロールールのアクション](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)」を参照してください。

- **プロパティ**: 条件、例外、またはアクションではない他のルール設定を指定します。 たとえば、いつルールを適用するか、ルールを強制するか、あるいはテストするかどうか、およびルールを有効化する期間などです。

  詳細に関しては、このトピックの「[メール フロー ルールのプロパティ](#mail-flow-rule-properties)」セクションを参照してください。

### <a name="multiple-conditions-exceptions-and-actions"></a>複数の条件、例外、アクション

次の表は、複数の条件、条件の値、例外、アクションが、ルールでどのように処理されるのかを説明しています。
  
|**コンポーネント**|**ロジック**|**コメント**|
|:-----|:-----|:-----|
|コメント|AND|メッセージは、ルールのすべての条件に一致しなければなりません。別々の条件に一致させる必要がある場合は、条件ごとに個別のルールを使用します。たとえば、ファイルが添付されたメッセージと、特定のテキストを含んでいるメッセージに同じ免責事項を追加するには、それぞれの条件ごとに 1 つのルールを作成します。EAC においては、ルールは簡単にコピーできます。|
|メッセージは、ルールのすべての条件に一致しなければなりません。別々の条件に一致させる必要がある場合は、条件ごとに個別のルールを使用します。たとえば、ファイルが添付されたメッセージと、コンテンツがパターンと一致するメッセージに同じ免責事項を追加するには、それぞれの条件ごとに 1 つのルールを作成します。ルールは簡単にコピーできます。|OR|条件によっては、複数の値を指定できる場合もあります。メッセージは指定された値の任意の 1 つ (すべてではない) に一致する必要があります。たとえば、メール メッセージの件名が「株価情報」で、 **[件名に次のいずれかの語が含まれている場合]** という条件が「 Contoso」または「株」のいずれかの単語に一致するよう構成されていたとすると、件名に値が少なくとも 1 つは含まれているので、この条件は満たされています。  |
|条件によっては、複数の値を指定できる場合もあります。1 つの条件に複数の値を入力できる場合、メッセージはその条件で指定された値のいずれかに一致する必要があります。たとえば、メール メッセージの件名が「株価情報」で、トランスポート ルールの [件名に次のいずれかの語が含まれている場合] という条件が「Contoso」または「株」のいずれかの単語に一致するよう構成されていたとすると、件名に条件の値が少なくとも 1 つは含まれているので、この条件は満たされています。|または|メッセージがいずれか 1 つの例外に一致すると、アクションはメッセージに適用されません。メッセージがすべての例外に一致する必要はありません。|
|メッセージがいずれかの例外に一致すると、アクションは実行されません。メッセージが、すべての例外に一致する必要はありません。|および|ルールの条件に一致するメッセージには、ルールに指定されるすべてのアクションが実行されます。たとえば、 **[メッセージの件名の先頭に付加する]** というアクションと、 **[受信者を BCC ボックスに追加する]** というアクションが選択されている場合、両方のアクションがメッセージに適用されます。  <br/><br/> ルールの条件に一致するメッセージには、そのルールで指定されたすべてのアクションが実行されます。たとえば、[メッセージの件名の先頭に付加する] というアクションと、[受信者を BCC ボックスに追加する] というアクションが選択されている場合、両方のアクションがメッセージに適用されます。メッセージには、メッセージの件名の先頭に指定の文字列が追加され、指定された受信者が BCC 受信者として追加されます。<br/><br/> ルールにアクションを設定して、そのルールが適用されたときに、メッセージにそれ以降のルールの適用されないようにすることもできます。|

### <a name="mail-flow-rule-properties"></a>メール フロー ルールのプロパティ

次の表で、メール フロー ルールで使用可能なルールのプロパティについて説明します。
  
|**EAC におけるプロパティ名**|**PowerShell におけるパラメーター名**|**説明**|
|:-----|:-----|:-----|
|**[優先度]**|_Priority_|メッセージにルールを適用する順番を示します。優先度の既定値はルールの作成時期に基づいています (古いルールのほうが新しいルールより優先度が高く、優先度の高いルールが優先度の低いルールよりも先に処理されます)。   <br/><br/> EAC 内でのルールの優先度は、ルール一覧内でそのルールを上下に移動させることで変更します。PowerShell では、優先度番号を設定します (0 が最高優先度)。   <br/><br/> たとえば、クレジット カード番号が含まれるメッセージを拒否するルールと、承認を必要とする別のルールがある場合、拒否のルールを最初に適用して、他のルールの適用を停止する必要があります。  |
|**[モード]**|_Mode_|ルールにすぐにメッセージの処理を開始させるか、あるいはメッセージの配信に影響を与えずにルールをテストするかどうかを指定することができます (データ紛失防止、DLP ポリシー ヒントの有無を問わず)。 <br/><br/> ポリシー ヒントは、メッセージを作成しているユーザーにそれがポリシー違反の可能性があることを通知する短いメモを、Outlook または Web 上の Outlook で提示します。詳細については、「 **Policy Tips** 」を参照してください。  <br/><br/> モードの詳細については、「 **Test a mail flow rule** 」を参照してください。|
|**次の日付でこのルールを有効にする** <br/><br/> **次の日付に、このルールを無効にする**|_ActivationDate_ <br/> _ExpiryDate_|ルールが有効化される日付の範囲を指定します。|
|選択されているかどうかに関わらず、チェック ボックスを **オン** にします。|新しいルール: **new-transportrule**コマンドレットの_Enabled_パラメーター。 <br/><br/> 既存のルール: **Enable-TransportRule** または **Disable-TransportRule** コマンドレットを使用します。 <br/><br/> 値はルールの **State** プロパティに表示されます。|無効なルールを作成して、それをテストする準備ができたときに有効にすることができます。または、設定を保持するために削除することなくルールを無効にすることができます|
|**[ルール処理が完了しない場合メッセージを優先する]**|_RuleErrorAction_|ルール処理が完了しない場合にメッセージをどのように扱うかを指定することができます。既定値ではルールは無視されますが、処理のためにメッセージを再送信することを選択できます。|
|**メッセージの送信者アドレスを一致**|_SenderAddressLocation_|ルールが送信者のメール アドレスを確認する例外や条件を使用する場合、メッセージ ヘッダー、メッセージのエンベロープ、またはその両方の値を検索できます。|
|**[ルールの処理を中止する]**|_SenderAddressLocation_|これはルールのアクションですが、EAC でのプロパティのように見えます。ルールがメッセージを処理した後に、追加のルールが適用されないように選択できます。|
|**コメント**|_Comments_|ルールに関する説明的なコメントを入力することができます。|

## <a name="how-mail-flow-rules-are-applied-to-messages"></a>メッセージへのメール フロー ルールの適用方法

組織を通過するすべてのメッセージが、組織内の有効にされているメール フロー ルールについて評価されます。 ルールは、EAC の [**メールフロー** \> **ルール**] ページに示されている順序で処理されるか、または PowerShell 内の対応する_Priority_パラメーターの値に基づいて処理されます。
  
各ルールでは、そのルールが一致した場合に、以降のルールの処理を停止するオプションを選択できます。この設定は、メッセージが複数のメール フロー ルールの条件に一致する場合に重要です (メッセージにどのルールを適用しますか?すべてですか?1 つだけですか?)。
  
### <a name="differences-in-processing-based-on-message-type"></a>メッセージの種類による処理の違い

組織を通過するメッセージにはいくつかの種類があります。次の表に、メール フロー ルールで処理できるメッセージの種類を示します。
  
****

|**メッセージの種類**|**ルールを適用可能か**|
|:-----|:-----|
|**通常のメッセージ**: 単一のリッチテキスト形式 (RTF)、HTML、プレーンテキストのメッセージ本文、またはメッセージ本文のマルチパートまたは代替セットが含まれるメッセージ。|はい|
|**Office 365 メッセージ暗号化**: office 365 での Office 365 メッセージの暗号化によって暗号化されたメッセージ。 詳細については、「 [Office 365 での暗号化](https://go.microsoft.com/fwlink/p/?LinkId=392525)」を参照してください。|ルールは常にエンベロープ ヘッダーにアクセスでき、それらのヘッダーを検査する条件に基づいてメッセージを処理できます。 <br/><br/> 暗号化されたメッセージのコンテンツをルールで検査または変更する場合、トランスポート復号化が有効になっていることを確認する必要があります (必須または省略可能。既定は省略可能です)。詳細については、「[トランスポート解読を有効または無効にする](https://go.microsoft.com/fwlink/p/?linkid=848060)」を参照してください。  <br/><br/> 暗号化されたメッセージを自動的に復号化するルールを作成することもできます。詳細については、「[電子メール メッセージの暗号化または暗号化解除ルールの定義](https://go.microsoft.com/fwlink/p/?Linkid=402846)」を参照してください。  |
|**S/MIME 暗号化されたメッセージ**|ルールは、エンベロープ ヘッダーにのみアクセスでき、それらのヘッダーを検査する条件に基づいてメッセージを処理できます。 <br/><br/> メッセージ コンテンツの検査を必要とする条件を使用したルール、またはメッセージのコンテンツを変更するアクションを処理することはできません。|
|**RMS で保護されたメッセージ**: Active Directory Rights management サービス (AD RMS) または Azure Rights MANAGEMENT (RMS) ポリシーが適用されているメッセージ。|ルールは常にエンベロープ ヘッダーにアクセスでき、それらのヘッダーを検査する条件に基づいてメッセージを処理できます。 <br/><br/> RMS で保護されたメッセージのコンテンツをルールで検査または変更する場合、トランスポート復号化が有効になっていることを確認する必要があります (必須または省略可能。既定は省略可能です)。詳細については、「[トランスポート解読を有効または無効にする](https://go.microsoft.com/fwlink/p/?linkid=848060)」を参照してください。  |
|**クリア署名付きメッセージ**: 署名されているが、暗号化されていないメッセージ。|はい|
|**UM メッセージ**: ボイスメール、fax、不在着信通知などのユニファイドメッセージングサービスによって作成または処理されたメッセージ、および Microsoft Outlook voice Access を使用して作成または転送されたメッセージ。|はい|
|**匿名メッセージ**: 匿名送信者によって送信されたメッセージ。|はい|
|**閲覧レポート**: 送信者からの開封確認要求に対する応答として生成されるレポート。 閲覧レポートには、または`IPM.Note*.MdnRead` `IPM.Note*.MdnNotRead`のメッセージクラスがあります。|はい|

## <a name="what-else-should-i-know"></a>その他の注意事項

- ルールの**バージョン**または**ruleversion**プロパティの値は、Exchange Online Protection では重要ではありません。

- メール フロー ルールを作成または変更した後に、新規または更新されたルールがメッセージに適用されるまで、最大で 30 分かかります。

## <a name="for-more-information"></a>詳細情報
  
[メールフロールールを使用して Exchange Online のメッセージの添付ファイルを検査する](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/inspect-message-attachments)
  
[Office 365 での電子メールの暗号化](https://docs.microsoft.com/office365/securitycompliance/email-encryption)
  
[ジャーナル、トランスポート、受信トレイのルール上の制限](https://go.microsoft.com/fwlink/p/?LinkId=324584)
